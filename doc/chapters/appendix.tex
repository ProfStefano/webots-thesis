\section{Correctness of the Bayes Filter Algorithm}\label{sec:ap:bayes-filter}
The current posterior distribution is calculated as it is shown in equation \ref{eq:ch-2:bel-derivation}.

\begin{equation}\label{eq:ch-2:bel-derivation}
p(x_t| z_{1:t}, u_{1:t}) = \frac{p(z_t | x_t, z_{1:t-1}, u_{1:t}) \: p(x_t | z_{1:t-1}, u_{1:t})}{p(z_t | z_{1:t-1}, u_{1:t})}
\end{equation}

Where,

\begin{itemize}
\item $p(x_t | z_{1:t-1}, u_{1:t})$ is the prior distribution. That is the information of state $x_t$ before seen the observation at time $t$.
\item $p(z_t | x_t, z_{1:t-1}, u_{1:t})$ is the likelihood model for the measurements. A causal, but noisy relationship\cite{Sarkka:bayesian-filters}. 
\item $p(z_t | z_{1:t-1}, u_{1:t})$ is the normalization constant defined as $\eta$
\end{itemize}

Thus equation \ref{eq:ch-2:bel-derivation} can be summarized as follows:

\begin{equation} \label{eq:ch-2:bel-derivation-2}
p(x_t| z_{1:t}, u_{1:t}) = \eta \: p(z_t | x_t, z_{1:t-1}, u_{1:t}) \: p(x_t | z_{1:t-1}, u_{1:t}) 
\end{equation}

The prediction of observation $z_t$ based on the state $x_t$, the previous observation $z_{1:t-1}$ and the control action $u_{1:t}$ has a conditional independence regarding the previous observation and the control action because they do not aport any information while predicting $z_t$. Thus the likelihood model for the measurements can be simplified as follows:

\begin{equation}
p(z_t | x_t, z_{1:t-1}, u_{1:t}) = p(z_t | x_t)
\end{equation}

Therefore equation \ref{eq:ch-2:bel-derivation-2} reduces to:

\begin{equation} \label{eq:ch-2:bel-derivation-3}
p(x_t| z_{1:t}, u_{1:t}) = \eta \: p(z_t | x_t) \: p(x_t | z_{1:t-1}, u_{1:t})
\end{equation}

In equation \ref{eq:ch-2:expand-prior-here} the prior distribution is expanded.

\begin{equation}\label{eq:ch-2:expand-prior-here}
p(x_t | z_{1:t-1}, u_{1:t}) = \int p(x_t | x_{t-1}, u_t) \: p(x_{t-1} | z_{1:t-1}, u_{1:t-1}) dx_{t-1}\\
= \overline{bel}(x_t)
\end{equation}

Replacing equation \ref{eq:ch-2:expand-prior-here} in \ref{eq:ch-2:bel-derivation-3}, equation \ref{eq:ch-2:bel-derivation-4} is obtained which is calculated by the algorithm in list \ref{ch-2:algo:bayes-filter}, third line.

\begin{equation}\label{eq:ch-2:bel-derivation-4}
p(x_t| z_{1:t}, u_{1:t}) = \eta \: p(z_t | x_t) \: \overline{bel}(x_t)
\end{equation}



















